---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { getLangFromUrl, useTranslations } from '../../utils/i18n';

export async function getStaticPaths() {
    const allPosts = await getCollection('blog');
    const paths = allPosts.map(post => {
        // Determine the language from the filename suffix (-es.md or -en.md)
        const isSpanish = post.id.endsWith('-es.md');
        const lang = isSpanish ? 'es' : 'en';

        // The `slug` already includes the language suffix from the filename
        // We pass it as-is for the `params` to match the URL.
        return {
            params: { slug: post.slug },
            props: { post, lang }
        };
    });
    return paths;
}

const { post, lang } = Astro.props;
const t = useTranslations(lang);
const { Content } = await post.render();
---
<Layout title={post.data.title} lang={lang}>
    <Header />
    <main>
        <article class="prose mx-auto py-12">
            <h1>{post.data.title}</h1>
            <Content />
        </article>
    </main>
    <Footer />
</Layout>

